#!/bin/sh

# Get local ip
#
# Copyright (c) 2015 David O'Trakoun <me@davidosomething.com>
#

set -eu

# silently determine existence of executable
__has_program() {
  command -v "$1" >/dev/null 2>&1
}

# type localip to get ethernet or wireless ip
__localip() {
  if [[ "$OSTYPE" == "darwin"* ]]; then
    local ethernet && ethernet=$(ipconfig getifaddr en0)
    [ -n "$ethernet" ] && echo "$ethernet" && exit 0

    local wireless && wireless=$(ipconfig getifaddr en1)
    [ -n "$wireless" ] && echo "$wireless" && exit 0

    exit 1
  fi

  if __has_program "hostname"; then
    hostname -i

  elif __has_program "ifconfig"; then
    ifconfig | grep "inet " | grep -v "127.0.0.1"

  elif __has_program "ip"; then
    ip addr | grep "inet 192"

  fi
}

__localip
