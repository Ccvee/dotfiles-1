#!/usr/bin/env bash

set -e

_e() {

  # VIM ---------------------------------------------------------------------

  # ssh'ed or no X
  [[ -n "$SSH_CONNECTION" ]] && return vim --nofork "${@}"
  [[ "$DOTFILES_OS" == "Linux" ]] && [[ -z "$DISPLAY" ]] && return vim --nofork "${@}"

  # GVIM ---------------------------------------------------------------------

  # HAS FILENAMES
  if [ $# -ne 0 ]; then
    # remote silent will FG the vim server
    gvim --nofork --servername GVIM --remote-silent "${@}"

  # NO FILENAMES
  # bring gvim server to FG if has an existing instance and no files
  elif gvim --nofork --serverlist | grep GVIM >/dev/null 2>&1; then
    gvim --nofork --servername GVIM --remote-send ":call foreground()<CR>"

  else
    gvim --nofork --servername GVIM

  fi

  exit 0
}

_e "${@}"

