#!/usr/bin/env bash
#
# Basic symlinks, safe to run on any system
#

# ============================================================================
# initialize script and dependencies
# ============================================================================

cd -- "$(dirname "$0")/.." || exit 1
readonly dotfiles_path="$(pwd)"
. "${DOTFILES}/lib/helpers.sh"
. "${DOTFILES}/lib/pretty.bash"

# ============================================================================
# Create paths (slow)
# ============================================================================

mkdir -p -- "${HOME}/.cache"
mkdir -p -- "${HOME}/.config"

# Mirror root in ~/.local
mkdir -p -- "${HOME}/.local/bin"
mkdir -p -- "${HOME}/.local/man/man1"
mkdir -p -- "${HOME}/.local/lib/R/library"
mkdir -p -- "${HOME}/.local/share/tig"

# ============================================================================
# Main
# ============================================================================

__symlink() {
  __dko_status "Symlinking dotfiles"

  # REQUIRED in ~/ -- ag looks for ~/.agignore LAST and includes it.
  # .ignore files are for project local only
  __dko_symlink  "shell/dot.profile" \
                ".profile"

  # REQUIRED in ~/ -- ag looks for ~/.agignore LAST and includes it.
  # .ignore files are for project local only
  __dko_symlink  "ag/dot.ignore" \
                ".agignore"

  # universal-ctags
  __dko_symlink  "universal-ctags/dot.ctags" \
                ".ctags"

  # XDG-compatible
  __dko_symlink  "atom/config.cson" \
                ".config/atom/config.cson"
  __dko_symlink  "git/dot.gitconfig" \
                ".config/git/config"
  __dko_symlink  "git/dot.gitignore" \
                ".config/git/ignore"
  __dko_symlink  "node/default-packages" \
                ".config/nvm/default-packages"
  __dko_symlink  "shell/dot.inputrc" \
                ".config/readline/inputrc"
  __dko_symlink  "redshift/redshift.conf" \
                ".config/redshift/redshift.conf"

  # (n)vim
  __dko_symlink  "vim" \
                ".vim"
  __dko_symlink  "vim" \
                ".config/nvim"

  # hyper.app
  __dko_symlink  "hyper-app/dot.hyper.js" \
                ".hyper.js"

  __dko_symlink  "oni/config.js" \
                ".oni/config.js"

  # default ~/.tern-config
  __dko_symlink  "ternjs/dot.tern-config" \
                ".tern-config"

  case "$OSTYPE" in
    darwin*)
      __dko_symlink  "hammerspoon" \
                    ".hammerspoon"
      __dko_symlink  "kitty/kitty.conf" \
                    "Library/Preferences/kitty/kitty.conf"
      __dko_symlink  "mac/dot.hushlogin" \
                    ".hushlogin"
      __dko_symlink  "mac/dotfiles.plist" \
                    "Library/LaunchAgents/dotfiles.plist"
      __dko_symlink  "subversion/config" \
                    ".subversion/config"
      ;;
    linux*)
      __dko_symlink  "linux/subversion/config" \
                    ".subversion/config"
      ;;
  esac

  # Shell
  __dko_symlink  "bash/dot.bashrc" \
                ".bashrc"
  __dko_symlink  "bash/dot.bash_profile" \
                ".bash_profile"
  __dko_symlink  "zsh/dot.zshenv" \
                ".zshenv"

  __dko_status "Done! [symlink.sh]"
}

__symlink
